{{meta {load_files: ["code/scripts.js", "code/chapter/05_higher_order.js", "code/intro.js"], zip: "node/html"}}}

# Higher-Order Functions

{{if interactive

{{quote {author: "Master Yuan-Ma", title: "The Book of Programming", chapter: true}

æå­å’Œè‹å­æ­£å¹å˜˜ä»–ä»¬æœ€æ–°ç¨‹åºçš„å¤§å°ã€‚â€œ20ä¸‡è¡Œâ€ï¼Œæå­è¯´ï¼Œâ€œä¸åŒ…æ‹¬æ³¨é‡Šï¼â€è‹å­å›ç­”åˆ°ï¼Œâ€œåˆ‡ï¼Œæˆ‘çš„å·²æœ‰å¤§çº¦ç™¾ä¸‡è¡Œäº†â€ã€‚å¸ˆå‚…é©¬åŸè¯´ï¼Œâ€œæˆ‘æœ€å¥½çš„ç¨‹åºæœ‰ 500è¡Œå­—ã€‚â€å¬åˆ°è¿™ä¸ªï¼Œæå­å’Œè‹å­è±ç„¶å¼€æœ—ã€‚

quote}}

if}}

{{quote {author: "C.A.R. Hoare", title: "1980 ACM Turing Award Lecture", chapter: true}

{{index "Hoare, C.A.R."}}

æ„å»ºè½¯ä»¶è®¾è®¡æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯è®©ç¨‹åºéå¸¸ç®€æ´ã€ä¸€ç›®äº†ç„¶ï¼Œå´ä»æ‰¾ä¸åˆ°ä»»ä½•æ˜æ˜¾çš„ç‘•ç–µã€‚å¦ä¸€ç§æ˜¯è®©ç¨‹åºåŠå…¶å¤æ‚ï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°ä»»ä½•æ˜æ˜¾çš„ç‘•ç–µã€‚

quote}}

{{figure {url: "img/chapter_picture_5.jpg", alt: "Letters from different scripts", chapter: true}}}

{{index "program size"}}

ä¸€ä¸ªå¤§ç¨‹åºæ˜¯éå¸¸æ˜‚è´µçš„ï¼Œè€Œä¸”ä¸åªå› ä¸ºå…¶æ‰€èŠ±è´¹çš„å¼€å‘æ—¶é—´ã€‚ç¨‹åºçš„å¤§å°å’Œ((å¤æ‚åº¦))å¯†åˆ‡ç›¸å…³ï¼Œç„¶è€Œå¤æ‚åº¦åªä¼šè¿·æƒ‘ç¨‹åºå‘˜ã€‚äºæ˜¯è¢«è¿·æƒ‘çš„ç¨‹åºå‘˜å†™å‡ºé”™è¯¯ï¼ˆ_((bug))s_ï¼‰çš„ä»£ç ã€‚æ‰€ä»¥ä¸€ä¸ªå¤§ç¨‹åºæ˜¯ä¸€ä¸ªç»™ bugs æä¾›äº†è¶³å¤Ÿéšè—ç©ºé—´çš„å¹³å°ï¼Œè®©å®ƒä»¬éš¾ä»¥è¢«æ‰¾åˆ°ã€‚

{{index "summing example"}}

è®©æˆ‘ä»¬å›é¡¾ä¸‹å¼€å¯¼ç¯‡çš„ä¸¤ä¸ªä¾‹é¢˜ç¨‹åºã€‚ç¬¬ä¸€ä¸ªæ˜¯ä¸ª6è¡Œçš„ç‹¬ç«‹ç¨‹åºã€‚

```
let total = 0, count = 1;
while (count <= 10) {
  total += count;
  count += 1;
}
console.log(total);
```

ç¬¬äºŒä¸ªéœ€è¦ä¸¤ä¸ªé¢å¤–çš„å‡½æ•°ï¼Œä½†æœ¬èº«åªæœ‰ä¸€è¡Œã€‚

```
console.log(sum(range(1, 10)));
```

å“ªä¸ªç¨‹åºæ›´å®¹æ˜“å‡ºé”™ï¼Ÿ

{{index "program size"}}

å¦‚æœæˆ‘ä»¬ç®—ä¸Š `sum` å’Œ `range` çš„å¤§å°ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªç¨‹åºä¹Ÿå¾ˆå¤§â€”â€”ç”šè‡³æ¯”ç¬¬ä¸€ä¸ªè¿˜å¤§ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä¾æ—§ç›¸ä¿¡ç¬¬ä¸€ä¸ªç¨‹åºæ›´å®¹æ˜“å‡ºé”™ã€‚

{{index [abstraction, "with higher-order functions"], "domain-specific language"}}

ç¬¬äºŒä¸ªç¨‹åºæ›´å¤§å¯èƒ½æ­£ç¡®æ˜¯å› ä¸ºå®ƒçš„ç­”æ¡ˆæ˜¯ä»¥ç¬¦åˆåŸé¢˜çš„((å•è¯))çš„å½¢å¼è¡¨è¾¾çš„ã€‚ä¸€ä¸ªèŒƒå›´å†…çš„ï¼ˆrangeï¼‰æ•°å­—çš„å’Œï¼ˆsumï¼‰å…¶å®å’Œå¾ªç¯ã€è®¡æ­¥å™¨æ— å…³ã€‚å®ƒå®Œå…¨æ˜¯å…³äºèŒƒå›´ï¼ˆrangeï¼‰ä»¥åŠå’Œï¼ˆsumï¼‰çš„ã€‚

å°½ç®¡è¿™ä¸ªå•è¯çš„å®šä¹‰ï¼ˆ`sum` å’Œ `range` å‡½æ•°ï¼‰ä¾æ—§éœ€è¦å¾ªç¯ã€è®¡æ­¥å™¨ã€å’Œå…¶ä»–é™„åŠ ç»†èŠ‚ã€‚ä½†å› ä¸ºå®ƒä»¬ä»¥æ›´ç®€å•çš„å½¢å¼ï¼Œè€Œä¸æ˜¯æ•´ä½“ï¼Œå±•ç°å‡ºæ¥ï¼Œæ‰€ä»¥æ›´å®¹æ˜“æ­£ç¡®ã€‚

## Abstraction

åœ¨ç¼–ç¨‹çš„ä¸–ç•Œï¼Œè¿™äº›å•è¯é€šå¸¸è¢«å«åš_((æŠ½è±¡åŒ–))_ã€‚æŠ½è±¡åŒ–æŠŠç»†èŠ‚éšè—èµ·æ¥ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨æ›´é«˜å±‚é¢ï¼ˆæ›´æŠ½è±¡åŒ–çš„ï¼‰æ¢è®¨é—®é¢˜ã€‚

{{index "recipe analogy", "pea soup"}}

æ‰“ä¸ªæ¯”æ–¹ï¼Œå¯¹æ¯”ä¸‹é¢ä¸¤ä¸ªè±Œè±†æ±¤çš„é£Ÿè°±ã€‚ç¬¬ä¸€ä¸ªå¦‚ä¸‹ï¼š

{{quote

æ¯äººä¸€æ¯å¹²è±Œè±†æ”¾å…¥å®¹å™¨ä¸­ã€‚åŠ æ°´æ²¡è‡³è±Œè±†ï¼Œæ³¡è‡³å°‘12å°æ—¶ã€‚ä»æ°´ä¸­å–å‡ºè±Œè±†ï¼Œæ”¾å…¥é”…ä¸­ã€‚æ¯äººå››æ¯æ°´åŠ å…¥é”…ä¸­ã€‚ç›–ä¸Šé”…ç›–ï¼Œç‚–2å°æ—¶ã€‚æ¯äººåŠä¸ªæ´‹è‘±ã€‚ç”¨åˆ€åˆ‡å—ï¼ŒåŠ å…¥è±†ä¸­ã€‚æ¯äººä¸€ä¸ªèŠ¹èœèŒï¼Œåˆ‡å—ï¼ŒåŠ å…¥è±†ä¸­ã€‚æ¯äººä¸€ä¸ªèƒ¡èåœï¼Œç”¨åˆ€åˆ‡å—ï¼ŒåŠ å…¥è±†ä¸­ã€‚å†ç…®10åˆ†é’Ÿã€‚

quote}}

ç¬¬äºŒä¸ªé£Ÿè°±å¦‚ä¸‹ï¼š

{{quote

æ¯äººï¼šä¸€æ¯å¹²è±Œè±†ï¼ŒåŠä¸ªåˆ‡å—çš„åœ†è‘±ï¼Œä¸€ä¸ªèŠ¹èœèŒï¼Œä¸€ä¸ªèƒ¡èåœã€‚

è±Œè±†æµ¸æ³¡12å°æ—¶ã€‚åœ¨4æ¯æ°´ï¼ˆæ¯äººï¼‰ä¸­ç‚–2å°æ—¶ã€‚åŠ å…¥åˆ‡å—çš„è”¬èœã€‚åœ¨ç…®10åˆ†é’Ÿã€‚

quote}}

{{index vocabulary}}

ç¬¬äºŒä¸ªæ›´ç®€çŸ­æ˜“æ‡‚ã€‚ä½†ä½ éœ€è¦ç†è§£ä¸€äº›åšé¥­ç›¸å…³çš„å•è¯ï¼š_æµ¸æ³¡_ï¼Œ_ç‚–_ï¼Œ_åˆ‡å—_ï¼Œä»¥åŠ_è”¬èœ_ã€‚

ç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä¾èµ–æ‰€æœ‰æ‰€éœ€å•è¯éƒ½åœ¨æˆ‘ä»¬çš„å­—å…¸ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé™·å…¥ç¬¬ä¸€ä¸ªèœè°±â€”â€”æŠŠç”µè„‘éœ€è¦è¿è¡Œçš„æ¯ä¸€æ­¥é€æ¬¡å†™ä¸‹ï¼Œå†æ··å…¥å®ƒä»¬ä»£è¡¨çš„é«˜å±‚æ¦‚å¿µä¸­ã€‚

{{index abstraction}}

ç¼–ç¨‹ä¸­ï¼Œå‘ç°ä½ ä½•æ—¶å¾˜å¾Šåœ¨ä½å±‚æŠ½è±¡åŒ–ä¸­çš„æŠ€å·§å¾ˆæœ‰ç”¨ã€‚

## Abstracting repetition

{{index [array, iteration]}}

æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„çº¯å‡½æ•°æ˜¯ä¸€ç§ä¸é”™çš„æŠ½è±¡åŒ–æ–¹æ³•ã€‚ç„¶è€Œå®ƒä»¬ä¸æ˜¯ä¸‡èƒ½çš„ã€‚

{{index "for loop"}}

ä¸€ä¸ªç¨‹åºç»å¸¸é‡å¤ç€åšä¸€ä»¶äº‹æƒ…è‹¥å¹²æ¬¡ã€‚æ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„ `for`((å¾ªç¯))ï¼š

```
for (let i = 0; i < 10; i++) {
  console.log(i);
}
```

é‚£æˆ‘ä»¬å¯ä»¥å°†â€œåšä¸€ä»¶äº‹æƒ… _N_ æ¬¡â€æŠ½è±¡æˆä¸€ä¸ªå‡½æ•°ä¹ˆï¼Ÿå¦‚æœä»…æ˜¯ä¸€ä¸ªé‡å¤ _N_ æ¬¡çš„ `console.log` çš„è¯ï¼Œæ˜¯è½»è€Œæ˜“ä¸¾çš„ï¼š

```
function repeatLog(n) {
  for (let i = 0; i < n; i++) {
    console.log(i);
  }
}
```

{{index [function, "higher-order"], loop, [function, "as value"]}}

{{indexsee "higher-order function", "function, higher-order"}}

ä½†å¦‚æœæˆ‘ä»¬æƒ³æ‰“å°å…¶ä»–éæ•°å­—çš„ä¸œè¥¿å‘¢ï¼Ÿâ€œåšä»¶äº‹â€å¯ä»¥ç”¨å‡½æ•°è¡¨ç¤ºï¼Œè€Œå‡½æ•°ä¹Ÿæ˜¯å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æƒ³åšçš„äº‹æƒ…å½“æˆå‡½æ•°å€¼ã€‚

```{includeCode: "top_lines: 5"}
function repeat(n, action) {
  for (let i = 0; i < n; i++) {
    action(i);
  }
}

repeat(3, console.log);
// â†’ 0
// â†’ 1
// â†’ 2
```

æˆ‘ä»¬ä¸éœ€è¦ç»™ `repeat` æä¾›ä¸€ä¸ªå·²å®šä¹‰çš„å‡½æ•°ã€‚é€šå¸¸ï¼Œå½“åœºåˆ›å»ºä¸€ä¸ªå‡½æ•°å€¼æ›´ç®€å•ã€‚

```
let labels = [];
repeat(5, i => {
  labels.push(`Unit ${i + 1}`);
});
console.log(labels);
// â†’ ["Unit 1", "Unit 2", "Unit 3", "Unit 4", "Unit 5"]
```

{{index "loop body", [braces, body], [parentheses, arguments]}}

è¿™ä¸ªçš„ç»“æ„ç±»ä¼¼äº `for` å¾ªç¯â€”â€”å…ˆå®šä¹‰å¾ªç¯çš„ç±»åˆ«ï¼Œåœ¨æä¾›å—ã€‚ä¸è¿‡ï¼Œè¿™é‡Œçš„å—æ˜¯è°ƒç”¨ `repeat` çš„æ‹¬å·åŒ…å›´ä½çš„å‡½æ•°å€¼ã€‚æ‰€ä»¥å®ƒéœ€è¦ä¸¤ä¸ªå³æ‹¬å·ï¼ˆåˆ†åˆ«ä¸º `}` å’Œ `)`ï¼‰ã€‚è¿™ç§ä»¥ä¸€å¥ç®€ä»‹çš„è¡¨è¾¾å¼ä¸ºå—çš„å‡½æ•°ä¹Ÿå¯ä»¥å»æ‰å¤§æ‹¬å·ï¼Œç®€åŒ–ä¸ºä¸€è¡Œã€‚

## Higher-order functions

{{index [function, "higher-order"], [function, "as value"]}}

åœ¨å…¶ä»–å‡½æ•°ä¸Šè¿è¡Œçš„å‡½æ•°ï¼Œä¸è®ºæ˜¯ä½œä¸ºå‚æ•°è¿˜æ˜¯è¿”å›çš„å€¼ï¼Œåˆå«_é«˜é˜¶å‡½æ•°_ã€‚å‡½æ•°å®é™…ä¸Šå°±æ˜¯æ™®é€šçš„å€¼ï¼Œå› æ­¤é«˜é˜¶å‡½æ•°çš„å­˜åœ¨å¹¶æ— ä»¤äººè¯§å¼‚ä¹‹å¤„ã€‚å®ƒçš„å‘½åæ¥è‡ªå¯¹å‡½æ•°å’Œå…¶ä»–å€¼é—´çš„åŒºåˆ«æ›´ä¸ºé‡è§†çš„((æ•°å­¦))ã€‚

{{index abstraction}}

é«˜é˜¶å‡½æ•°ä½¿æˆ‘ä»¬ä¸ä»…å¯ä»¥æŠ½è±¡åŒ–å€¼ï¼Œè¿˜å¯ä»¥æŠ½è±¡åŒ–_æ“ä½œ_ã€‚å®ƒä»¬æœ‰å‡ ç§å½¢å¼ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°åˆ›å»ºæ–°çš„å‡½æ•°ã€‚

```
function greaterThan(n) {
  return m => m > n;
}
let greaterThan10 = greaterThan(10);
console.log(greaterThan10(11));
// â†’ true
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å‡½æ•°æ”¹å˜å…¶ä»–å‡½æ•°ã€‚

```
function noisy(f) {
  return (...args) => {
    console.log("calling with", args);
    let result = f(...args);
    console.log("called with", args, ", returned", result);
    return result;
  };
}
noisy(Math.min)(3, 2, 1);
// â†’ calling with [3, 2, 1]
// â†’ called with [3, 2, 1] , returned 1
```

æˆ‘ä»¬ç”šè‡³å¯ä»¥ç”¨å‡½æ•°æä¾›æ–°çš„((æ§åˆ¶æµ))ã€‚

```
function unless(test, then) {
  if (!test) then();
}

repeat(3, n => {
  unless(n % 2 == 1, () => {
    console.log(n, "is even");
  });
});
// â†’ 0 is even
// â†’ 2 is even
```

{{index [array, methods], [array, iteration], "forEach method"}}

æœ‰ä¸€ä¸ªå†…ç½®çš„æ•°ç»„æ–¹æ³• `forEach` æä¾›ç±»ä¼¼ `for`/`of` å¾ªç¯çš„é«˜é˜¶å‡½æ•°ã€‚

```
["A", "B"].forEach(l => console.log(l));
// â†’ A
// â†’ B
```

## Script data set

é«˜é˜¶å‡½æ•°å¤§æ”¾å¼‚å½©çš„é¢†åŸŸä¹‹ä¸€æ˜¯æ•°æ®å¤„ç†ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€äº›æ•°æ®ã€‚æœ¬ç« ä¼šç”¨ä¸€ä¸ªå…³äºæ–‡å­—çš„((æ•°æ®é›†))â€”â€”æ¯”å¦‚æ‹‰ä¸æ–‡ã€è¥¿é‡Œå°”æ–‡ã€æˆ–è€…é˜¿æ‹‰ä¼¯æ–‡ã€‚

[ç¬¬ä¸€ç« ](values#unicode)ä¸­æˆ‘ä»¬è®²è¿‡((Unicode))ï¼Œä¸€ä¸ªä¸ºæ¯ä¸ªå­—ç¬¦åˆ†é…ä¸€ä¸ªæ•°å­—çš„ç³»ç»Ÿã€‚å¤§éƒ¨åˆ†çš„å­—ç¬¦éƒ½å’Œä¸€ä¸ªç‰¹å®šçš„æ–‡å­—æœ‰å…³ã€‚æ ‡å‡†çš„åŒ…æ‹¬ 140ä¸ªä¸åŒæ–‡å­—ï¼Œå…¶ä¸­ 81ä¸ªä»Šå¤©ä»åœ¨ä½¿ç”¨ï¼Œ59ä¸ªå·²æˆä¸ºå†å²ã€‚

å°½ç®¡æˆ‘ç»å¸¸åªè¯»æ‹‰ä¸æ–‡å­—ï¼Œæˆ‘ä¾æ—§æ„Ÿæ¿€å…¶ä»–80ä½™ä¸ªä»è¢«ä¸–äººä½¿ç”¨çš„æ–‡å­—ï¼Œå°½ç®¡å¤§éƒ¨åˆ†æˆ‘æ ¹æœ¬æ— æ³•è¯†åˆ«ã€‚æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ç”¨((æ³°ç±³å°”è¯­))æ‰‹å†™çš„ä¸€æ®µæ–‡å­—ï¼š

{{figure {url: "img/tamil.png", alt: "Tamil handwriting"}}}

{{index "SCRIPTS data set"}}

ä¾‹é¢˜ä¸­çš„((æ•°æ®é›†))åŒ…æ‹¬äº†ä¸€äº›å…³äº Unicode ä¸­å®šä¹‰çš„ 140ä¸ªæ–‡å­—ã€‚å¯ä»¥åœ¨æœ¬ç« [([_https://eloquentjavascript.net/code#5_](https://eloquentjavascript.net/code#5))]{if book} [æ²™ç›’](https://eloquentjavascript.net/code#5)ä¸­çš„ `SCRIPTS` å˜é‡ä¸­æ‰¾åˆ°ã€‚è¯¥å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡æè¿°äº†ä¸€ä¸ªæ–‡å­—ã€‚


```{lang: "application/json"}
{
  name: "Coptic",
  ranges: [[994, 1008], [11392, 11508], [11513, 11520]],
  direction: "ltr",
  year: -200,
  living: false,
  link: "https://en.wikipedia.org/wiki/Coptic_alphabet"
}
```

è¿™ç§å¯¹è±¡å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ–‡å­—çš„åå­—ï¼Œå¯¹åº”çš„ Unicdoe èŒƒå›´ï¼Œä¹¦å†™çš„æ–¹å‘ï¼Œï¼ˆå¤§ä½“ï¼‰å‡ºç°æ—¶é—´ï¼Œå¦‚ä»Šæ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ï¼Œä»¥åŠä¸€ä¸ªå¯ä»¥è·å–æ›´å¤šä¿¡æ¯çš„é“¾æ¥ã€‚ä¹¦å†™æ–¹å‘å¯ä»¥æ˜¯ `"ltr"`ï¼Œå³ä»å·¦åˆ°å³ï¼›`"rtl"`ï¼Œä»å³åˆ°å·¦ï¼ˆæ¯”å¦‚é˜¿æ‹‰ä¼¯æ–‡æˆ–å¸Œä¼¯æ¥æ–‡ï¼‰ï¼›æˆ–`"ttb"`ï¼Œä»ä¸Šåˆ°ä¸‹ï¼ˆå¦‚è’™å¤æ–‡ï¼‰ã€‚

{{index "slice method"}}

`ranges`å±æ€§æ˜¯ä¸€ä¸ª Unicode èŒƒå›´çš„æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªäºŒå…ƒç´ çš„æ•°ç»„ï¼Œåˆ†åˆ«ä»£è¡¨ä¸‹ç•Œå’Œä¸Šç•Œã€‚æ¯ä¸ªåœ¨è¿™ä¸ªèŒƒå›´å†…çš„å­—ç¬¦ç éƒ½å±äºè¯¥æ–‡å­—ã€‚è¯¥èŒƒå›´åŒ…æ‹¬ä¸‹((ç•Œ))ï¼ˆ994 æ˜¯ä¸€ä¸ªç§‘æ™®ç‰¹å­—æ¯ï¼‰ï¼Œä½†ä¸åŒ…æ‹¬ä¸Šç•Œï¼ˆ1008 ä¸æ˜¯ï¼‰ã€‚

## Filtering arrays

{{index [array, methods], [array, filtering], "filter method", [function, "higher-order"], "predicate function"}}

ä¸‹é¢çš„å‡½æ•°å¯å¸®åŠ©ä½ æ‰¾å¯»æ•°æ®é›†ä¸­ä»åœ¨ä½¿ç”¨çš„æ–‡å­—ã€‚å®ƒä¼šè¿‡æ»¤æ‰é‚£äº›ä¸ç¬¦åˆè¦æ±‚çš„æ•°ç»„å…ƒç´ ã€‚

```
function filter(array, test) {
  let passed = [];
  for (let element of array) {
    if (test(element)) {
      passed.push(element);
    }
  }
  return passed;
}

console.log(filter(SCRIPTS, script => script.living));
// â†’ [{name: "Adlam", â€¦}, â€¦]
```

{{index [function, "as value"], [function, application]}}

è¯¥å…ƒç´ ç”¨ä¸€ä¸ªåä¸º `test` çš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°å€¼ï¼Œæ¥å®Œæˆè®¡ç®—ä¸­çš„ç©ºç™½â€”â€”å†³å®šä¿ç•™å“ªä¸ªå…ƒç´ çš„è¿‡ç¨‹ã€‚

{{index "filter method", "pure function", "side effect"}}

è¯·æ³¨æ„ `filter` å‡½æ•°ï¼Œä¸å…¶ä»åŸæ•°ç»„ä¸­åˆ é™¤å…ƒç´ ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å‚¨å­˜åŸæ•°ç»„ä¸­ç¬¦åˆè¦æ±‚çš„å…ƒç´ ã€‚å› æ­¤å®ƒæ˜¯ä¸€ä¸ª_çº¯_å‡½æ•°ã€‚å®ƒä¸ä¼šæ›´æ”¹å‚æ•°ã€‚

`forEach` å’Œ `filter` éƒ½æ˜¯((æ ‡å‡†))æ•°ç»„æ–¹æ³•ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­å°†å®ƒä»¬çš„å®é™…å®šä¹‰å†™äº†å‡ºæ¥ã€‚ä»ç°åœ¨èµ·ï¼Œæˆ‘ä»¬ä¼šä»¥ä¸‹é¢çš„æ–¹æ³•è°ƒç”¨å®ƒä»¬ï¼š

```
console.log(SCRIPTS.filter(s => s.direction == "ttb"));
// â†’ [{name: "Mongolian", â€¦}, â€¦]
```

{{id map}}

## Transforming with map

{{index [array, methods], "map method"}}

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä» `SCRIPTS` å˜é‡ä¸­è¿‡æ»¤å‡ºæ¥çš„æ–‡å­—å¯¹è±¡çš„æ•°ç»„ã€‚ä½†ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬åªæƒ³è¦ä¸€ä¸ªåå­—æ•°ç»„ã€‚

{{index [function, "higher-order"]}}

`map` æ–¹æ³•å¯ä»¥å¯¹æ‰€æœ‰å…ƒç´ è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚è¿”å›çš„æ–°æ•°ç»„å’ŒåŸæ•°ç»„çš„é•¿åº¦ç›¸åŒï¼Œä½†å…¶å†…å®¹æ˜¯è¢«å‡½æ•°æ‰€_æ˜ å°„è¿‡_çš„æ–°å€¼ã€‚

```
function map(array, transform) {
  let mapped = [];
  for (let element of array) {
    mapped.push(transform(element));
  }
  return mapped;
}

let rtlScripts = SCRIPTS.filter(s => s.direction == "rtl");
console.log(map(rtlScripts, s => s.name));
// â†’ ["Adlam", "Arabic", "Imperial Aramaic", â€¦]
```

åŒ `forEach` ä»¥åŠ `filter` ä¸€æ ·ï¼Œ`map` ä¹Ÿæ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ•°ç»„æ–¹æ³•ã€‚

## Summarizing with reduce

{{index [array, methods], "summing example", "reduce method"}}

å¦ä¸€ä¸ªå¸¸ç”¨çš„æ•°ç»„æ“ä½œæ˜¯å°†å®ƒä»¬å˜æˆä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬çš„è€æœ‹å‹ï¼Œä¸€ä¸ªæ•°å­—é›†çš„å’Œï¼Œå°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯æ‰¾åˆ°å­—ç¬¦æœ€å¤šçš„æ–‡å­—ã€‚

{{indexsee "fold", "reduce method"}}

{{index [function, "higher-order"], "reduce method"}}

è¡¨ç¤ºè¿™ç§é«˜çº§æ“ä½œçš„å‡½æ•°å« _ç¼©å‡_ï¼ˆæœ‰äº›æ—¶å€™ä¹Ÿå« _fold_ï¼‰ã€‚å®ƒé€šè¿‡åå¤ä»æ•°ç»„ä¸­æå–ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…¶äºç°æœ‰çš„å€¼ç»“å’Œï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ–°å€¼ã€‚åœ¨è®¡ç®—æ•°å­—å’Œæ—¶ï¼Œæˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªæ•°å­—å¼€å§‹ï¼Œé€ä¸€æ·»åŠ æ•°å­—è‡³å’Œã€‚

`reduce` çš„å‚æ•°åŒ…æ‹¬ï¼Œé™¤äº†æ•°ç»„å¤–ï¼Œä¸€ä¸ªç»„åˆå‡½æ•°å’Œä¸€ä¸ªèµ·å§‹å€¼ã€‚è¿™ä¸ªå‡½æ•°æ¯” `filter` å’Œ `map` ç•¥å¾®å¤æ‚ï¼Œè®©æˆ‘ä»¬ç»†çœ‹ä¸€ä¸‹ï¼š

```
function reduce(array, combine, start) {
  let current = start;
  for (let element of array) {
    current = combine(current, element);
  }
  return current;
}

console.log(reduce([1, 2, 3, 4], (a, b) => a + b, 0));
// â†’ 10
```

{{index "reduce method", "SCRIPTS data set"}}

ä¸Šé¢å°±æ˜¯æ ‡å‡†çš„æ•°ç»„æ–¹æ³• `reduce`ï¼Œå®ƒæœ‰ä¸€ä¸ªé™„èµ çš„ä¾¿åˆ©ã€‚å¦‚æœä½ çš„æ•°ç»„åŒ…å«è‡³å°‘ä¸€ä¸ªå…ƒç´ ï¼Œä½ å°±å¯ä»¥ä¸æä¾› `start` å‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå°†æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºå®ƒçš„èµ·å§‹å€¼ï¼Œå¹¶ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ç¼©å‡ã€‚

```
console.log([1, 2, 3, 4].reduce((a, b) => a + b));
// â†’ 10
```

{{index maximum, "characterCount function"}}

æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œä½¿ç”¨ `reduce`ï¼ˆä¸¤æ¬¡ï¼‰æ¥æ‰¾å¯»æœ€å¤šå­—ç¬¦çš„æ–‡å­—ï¼š

```
function characterCount(script) {
  return script.ranges.reduce((count, [from, to]) => {
    return count + (to - from);
  }, 0);
}

console.log(SCRIPTS.reduce((a, b) => {
  return characterCount(a) < characterCount(b) ? b : a;
}));
// â†’ {name: "Han", â€¦}
```

å‡½æ•° `characterCount` è´Ÿè´£é€šè¿‡ç¼©å‡èŒƒå›´è®¡ç®—å‡ºæ¯ä¸ªæ–‡å­—çš„å­—ç¬¦æ€»å’Œã€‚æ³¨æ„æ”¹ç¼©å‡å‡½æ•°çš„å‚æ•°ä¸­è§£æ„èµ‹å€¼çš„ä½¿ç”¨ã€‚ç¬¬äºŒä¸ª `reduce` è°ƒç”¨åˆ™é€šè¿‡åå¤æ¯”è¾ƒä¸¤ä¸ªæ–‡å­—çš„å­—ç¬¦æ€»å’Œæ¥æ‰¾å¯»å­—ç¬¦æ•°é‡æœ€å¤šçš„æ–‡å­—ã€‚æœ€åè¿”å›æœ€å¤§çš„é‚£ä¸ªã€‚

åœ¨ Unicode ä¸­ï¼Œæ±‰å­—æœ‰è¶…è¿‡ 89000 ä¸ªæ–‡å­—ï¼Œæ‰€ä»¥å®ƒæ˜¯è¯¥æ•°æ®é›†ä¸­æ‹¥æœ‰æœ€å¤šå­—ç¬¦çš„æ–‡å­—ã€‚æ±‰å­—æ˜¯ä¸ªï¼ˆæœ‰æ—¶ï¼‰ç”¨äºä¸­æ–‡ã€æ—¥æ–‡ã€å’ŒéŸ©æ–‡çš„æ–‡å­—ã€‚è¿™äº›è¯­è¨€åˆ†äº«å¾ˆå¤šå­—ç¬¦ï¼Œå°½ç®¡å®ƒä»¬çš„ä¹¦å†™æ–¹å¼ä¸ä¸€æ ·ã€‚ï¼ˆä½äºç¾å›½çš„ï¼‰Unicode é›†å›¢å†³å®šå°†å®ƒä»¬å½’çº³äºåŒä¸€ä¸ªä¹¦å†™ç³»ç»Ÿï¼Œä»è€ŒèŠ‚çœå­—ç¬¦ç ã€‚è¿™ä¸ªå«åš_æ±‰å­—ç»Ÿä¸€_ï¼Œå°½ç®¡å¾ˆå¤šäººå¯¹æ­¤å¾ˆä¸æ»¡æ„ã€‚

## Composability

{{index loop, maximum}}

è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨æ²¡æœ‰é«˜é˜¶å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•ç¼–å†™ä¸Šé¢çš„ä¾‹é¢˜ï¼ˆæ‰¾å¯»æœ€å¤§çš„æ–‡å­—ï¼‰ã€‚å…¶ä»£ç å…¶å®æ²¡æœ‰é‚£ä¹ˆå¤¸å¼ ï¼š

```{test: no}
let biggest = null;
for (let script of SCRIPTS) {
  if (biggest == null ||
      characterCount(biggest) < characterCount(script)) {
    biggest = script;
  }
}
console.log(biggest);
// â†’ {name: "Han", â€¦}
```

å°½ç®¡æˆ‘ä»¬éœ€è¦æ›´å¤šçš„å˜é‡ï¼Œä¸”è¯¥ç¨‹åºä¹Ÿå¤šäº†å››è¡Œã€‚ä½†æ€»ä½“è€Œè¨€è¿˜æ˜¯ç®€æ´æ˜äº†çš„ã€‚

{{index "average function", composability, [function, "higher-order"], "filter method", "map method", "reduce method"}}

{{id average_function}}

é«˜é˜¶å‡½æ•°åœ¨ä½ éœ€è¦_ç¼–å†™_æ“ä½œæ—¶å¤§æ”¾å¼‚å½©ã€‚æ¯”å¦‚ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ªæ‰¾å¯»æ•°æ®é›†ä¸­ä»åœ¨ä½¿ç”¨çš„å’Œåœæ­¢ä½¿ç”¨çš„æ–‡å­—çš„å¹³å‡èµ·æºå¹´ä»½ã€‚

```
function average(array) {
  return array.reduce((a, b) => a + b) / array.length;
}

console.log(Math.round(average(
  SCRIPTS.filter(s => s.living).map(s => s.year))));
// â†’ 1165
console.log(Math.round(average(
  SCRIPTS.filter(s => !s.living).map(s => s.year))));
// â†’ 204
```

å¹³å‡æ¥è®²ï¼Œå·²åœæ­¢ä½¿ç”¨çš„æ–‡å­—çš„å¯¿å‘½æ¯”ä»åœ¨ä½¿ç”¨çš„æ–‡å­—å¯¿å‘½è¦é•¿ã€‚å½“ç„¶è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰æˆ–ä»¤äººæƒŠè®¶çš„æ•°æ®ã€‚ä½†æˆ‘å¸Œæœ›ä½ ä¹Ÿè®¤åŒä¸Šé¢çš„è¿ç®—ä»£ç å¹¶ä¸å¤æ‚ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªä¼ é€’é€”å¾„ï¼šæˆ‘ä»¬ä»æ‰€æœ‰æ–‡å­—å¼€å§‹ï¼Œè¿‡æ»¤æ‰æ­£åœ¨ä½¿ç”¨ï¼ˆæˆ–è€…å·²åœæ­¢ä½¿ç”¨ï¼‰çš„ï¼Œè®°å½•è¿™äº›æ–‡å­—çš„å¹´ä»½ï¼Œç®—å®ƒä»¬çš„å¹³å‡æ•°ï¼Œå››èˆäº”å…¥æœ€åçš„ç»“æœã€‚

ä½ å½“ç„¶ä¹Ÿå¯ä»¥æŠŠå®ƒå†™æˆä¸€ä¸ªåºå¤§çš„((å¾ªç¯))ã€‚

```
let total = 0, count = 0;
for (let script of SCRIPTS) {
  if (script.living) {
    total += script.year;
    count += 1;
  }
}
console.log(Math.round(total / count));
// â†’ 1165
```

ä½†è¿™ä¸ªç›¸å¯¹è€Œè¨€è¾ƒéš¾çœ‹å‡ºå®ƒåœ¨åšä»€ä¹ˆã€‚è€Œä¸”å› ä¸ºä¸­é—´çš„ç»“æœå¹¶ä¸æ˜¯è¿è´¯çš„å€¼ï¼Œåè€Œéœ€è¦æ›´å¤šå·¥ä½œå°† `average` æå–åˆ°ç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚

{{index efficiency, [array, creation]}}

è‡³äºç”µè„‘çš„å®é™…è¿è¡Œæƒ…å†µè€Œè¨€ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿæˆªç„¶ä¸åŒã€‚ç¬¬ä¸€ä¸ªä¼šåœ¨è¿è¡Œ `filter` å’Œ `map` æ—¶åˆ›å»ºæ–°çš„æ•°ç»„ï¼Œè€Œç¬¬äºŒä¸ªåˆ™å‡å°‘å·¥ä½œé‡åªä¼šè®¡ç®—ä¸€äº›æ•°å­—ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç®€è€Œæ˜“æ‡‚çš„æ–¹æ³•ï¼Œä½†å¦‚æœåå¤å¤„ç†å¤§é‡æ•°ç»„ï¼Œé‚£ä¹ˆç¬¬äºŒç§æ–¹æ³•çš„æ•ˆç‡æ›´é«˜ã€‚

## Strings and character codes

{{index "SCRIPTS data set"}}

è¯¥æ•°æ®é›†çš„ä¸€ä¸ªç”¨é€”æ˜¯åˆ¤æ–­ä¸€ç¯‡æ–‡ç« ç”¨äº†ä»€ä¹ˆæ–‡å­—ã€‚è®©æˆ‘ä»¬ä¸€èµ·è°±å†™è¯¥ç¨‹åºã€‚

è¿˜è®°å¾—æ¯ä¸ªæ–‡å­—éƒ½æœ‰ä¸ªå­—ç¬¦ç èŒƒå›´çš„æ•°ç»„ä¹ˆï¼Ÿæ‰€ä»¥å·²çŸ¥ä¸€ä¸ªå­—ç¬¦ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‡½æ•°æ‰¾åˆ°å®ƒæ‰€å¯¹åº”çš„æ–‡å­—ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼š

{{index "some method", "predicate function", [array, methods]}}

```{includeCode: strip_log}
function characterScript(code) {
  for (let script of SCRIPTS) {
    if (script.ranges.some(([from, to]) => {
      return code >= from && code < to;
    })) {
      return script;
    }
  }
  return null;
}

console.log(characterScript(121));
// â†’ {name: "Latin", â€¦}
```

`some` æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªåˆ¤æ–­å‡½æ•°ï¼Œå¹¶å‘Šè¯‰ä½ æ•°ç»„ä¸­çš„å“ªä¸ªå…ƒç´ ç¬¦åˆè¯¥å‡½æ•°çš„åˆ¤æ–­æ¡ä»¶ã€‚

{{id code_units}}

ä½†æˆ‘ä»¬å¦‚ä½•ä»å­—ç¬¦ä¸²ä¸­å¾—åˆ°å­—ç¬¦ç ï¼Ÿ

åœ¨[ç¬¬ä¸€ç« ](values)ä¸­ï¼Œæˆ‘è¯´è¿‡ JavaScript çš„((å­—ç¬¦ä¸²))æ˜¯ä¸€ä¸ª16ä½æ•°å­—åºåˆ—ã€‚å®ƒä»¬å«åš_((ç å•ä½))_ã€‚ä¸€ä¸ª ((Unicode)) ((å­—ç¬¦))ç å•ä½æœ€å¼€å§‹åº”è¯¥åœ¨è¿™ä¸ªå•ä½ä¸­ï¼ˆå·®ä¸å¤š 65000 ä¸ªå­—ç¬¦ï¼‰ã€‚å½“äº‹å®è¯æ˜è¿™äº›å­—ç¬¦è¿œä¸å¤Ÿç”¨æ—¶ï¼Œæœ‰äº›äººåœ¨æ˜¯å¦éœ€è¦å¯¹æ¯ä¸ªå­—ç¬¦ä½¿ç”¨é¢å¤–å†…å­˜ä¸­çŠ¹è±«ä¸å†³ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå‘æ˜äº† ((UTF-16))ï¼ŒJavaScript å­—ç¬¦ä¸²çš„æ ¼å¼ã€‚å®ƒä½¿ç”¨å•ä¸ª 16ä½ç å•ä½æè¿°æœ€å¸¸è§çš„å­—ç¬¦ï¼Œä½†ç”¨ä¸€å¯¹ç å•ä½æè¿°å…¶ä»–å­—ç¬¦ã€‚

{{index error}}

å¦‚ä»Šæ™®éè®¤ä¸º UTF-16 æ˜¯ä¸ªåä¸»æ„ã€‚å®ƒå‡ ä¹æ˜¯æ•…æ„ä¸ºå¼•èµ·é”™è¯¯è€Œè®¾è®¡çš„ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å†™ä¸€ä¸ªä»£ç å°†ä¸€ä¸ªç å•ä½ç­‰åŒäºä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœé‡åˆ°ä¸€ä¸ªä¸ä½¿ç”¨ä¸€å¯¹ç å•ä½çš„æ–‡å­—ï¼Œè¿™ä¸ªç¨‹åºä¸ä¼šé‡åˆ°ä»»ä½•é—®é¢˜ã€‚ä¸€æ—¦å°†å…¶ç”¨äºåŒç å•ä½çš„((æ±‰å­—))ä¸­ï¼Œå®ƒå°†ä¸ä¼šå·¥ä½œã€‚å¥½åœ¨ï¼Œéšç€((è¡¨æƒ…ç¬¦åˆ))çš„è¯ç”Ÿï¼Œæ‰€æœ‰äººéƒ½å¼€å§‹ä½¿ç”¨åŒç å•ä½ï¼Œå› æ­¤å¤„ç†æ­¤ç±»é—®é¢˜çš„è´Ÿæ‹…è¾ƒä¸ºå¹³æ‘Šäº†ã€‚

{{index [string, length], [string, indexing], "charCodeAt method"}}

ä¸å¹¸çš„æ˜¯ï¼ŒJavaScript å­—ç¬¦ä¸²çš„æ™®éæ“ä½œï¼Œæ¯”å¦‚é€šè¿‡ `length` å±æ€§å¾—åˆ°å®ƒä»¬çš„é•¿åº¦ï¼Œæˆ–è€…é€šè¿‡ä¸­æ‹¬å·å¾—åˆ°å®ƒä»¬çš„å†…å®¹ï¼Œåªå¯¹å•ç å•ä½æœ‰æ•ˆã€‚

```{test: no}
// ä¸¤ä¸ªè¡¨æƒ…ç¬¦åˆï¼šé©¬å’Œé‹
let horseShoe = "ğŸ´ğŸ‘Ÿ";
console.log(horseShoe.length);
// â†’ 4
console.log(horseShoe[0]);
// â†’ (æ— æ•ˆçš„åŠå­—ç¬¦)
console.log(horseShoe.charCodeAt(0));
// â†’ 55357 (è¿™ä¸ªåŠå­—ç¬¦æ‰€å¯¹åº”çš„å­—ç¬¦ç )
console.log(horseShoe.codePointAt(0));
// â†’ 128052 (é©¬çš„è¡¨æƒ…ç¬¦å·å®é™…å¯¹åº”çš„å­—ç¬¦ç )
```

{{index "codePointAt method"}}

JavaScript çš„ `charCodeAt` æ–¹æ³•è¿”å›ä¸€ä¸ªç å•ä½ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ç ã€‚è€ŒååŠ å…¥çš„ `codePointAt` æ–¹æ³•åˆ™è¿”å›ä¸€ä¸ªå®Œæ•´çš„ Unicode å­—ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒè¯»å–å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ã€‚ä½† `codePointAt` çš„å‚æ•°ä¾æ—§æ˜¯ä¸€ä¸ªç å•ä½åºåˆ—çš„ç´¢å¼•ã€‚å› æ­¤æˆ‘ä»¬ä¾æ—§éœ€è¦è§£å†³ä¸€ä¸ªå­—ç¬¦æ˜¯å•ç è¿˜æ˜¯åŒç çš„é—®é¢˜ï¼Œæ‰èƒ½é€ä¸€è¯»å–å•ä¸ªå­—ç¬¦ã€‚

{{index "for/of loop", character}}

[ä¸Šä¸€ç« ](data#for_of_loop)ä¸­ï¼Œæˆ‘è¯´è¿‡ `for`/`of` å¾ªç¯å¯ä»¥ç”¨äºå­—ç¬¦ä¸²ã€‚ç±»ä¼¼ `codePointAt`ï¼Œè¿™ç±»å¾ªç¯ä¹Ÿæ˜¯åœ¨å¤§å®¶å‘ç° UTF-16 çš„é—®é¢˜åæ·»åŠ çš„ã€‚å› æ­¤ç”¨å®ƒéå†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒä¼šè¯»å–çœŸæ­£çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯å•ä¸ªçš„ç å•ä½ã€‚

```
let roseDragon = "ğŸŒ¹ğŸ‰";
for (let char of roseDragon) {
  console.log(char);
}
// â†’ ğŸŒ¹
// â†’ ğŸ‰
```

å¦‚æœä½ æœ‰ä¸€ä¸ªå­—ç¬¦ï¼ˆä¸€ä¸ªå•ç æˆ–åŒç çš„å­—ç¬¦ä¸²ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ `codePointAt(0)` å¾—åˆ°å…¶å¯¹äºçš„ç¼–ç ã€‚

## Recognizing text

{{index "SCRIPTS data set", "countBy function", [array, counting]}}

æˆ‘ä»¬æœ‰ä¸€ä¸ª `characterScript` å‡½æ•°å’Œä¸€ä¸ªå¯ä»¥æ­£ç¡®è¯»å–å­—ç¬¦çš„æ–¹æ³•ã€‚ä¸‹ä¸€æ­¥å°±æ˜¯ç»Ÿè®¡å‡ºç°åœ¨æ¯ä¸ªæ–‡å­—ä¸­çš„å­—ç¬¦äº†ã€‚ä¸‹é¢çš„æŠ½è±¡åŒ–çš„ç»Ÿè®¡å‡½æ•°ä¼šå¸®åŠ©åˆ°ä½ ï¼š

```{includeCode: strip_log}
function countBy(items, groupName) {
  let counts = [];
  for (let item of items) {
    let name = groupName(item);
    let known = counts.findIndex(c => c.name == name);
    if (known == -1) {
      counts.push({name, count: 1});
    } else {
      counts[known].count++;
    }
  }
  return counts;
}

console.log(countBy([1, 2, 3, 4, 5], n => n > 2));
// â†’ [{name: false, count: 2}, {name: true, count: 3}]
```

`countBy` å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªé›†ï¼ˆä»»ä½•å¯ä»¥è¢« `for`/`of` éå†çš„æ•°æ®ç»“æ„ï¼‰å’Œä¸€ä¸ªä¸ºç»™å®šå…ƒç´ è®¡ç®—ç»„åçš„å‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªéƒ½æœ‰ä¸€ä¸ªç»„åå’Œè¯¥ç»„ä¸­å­˜åœ¨çš„å…ƒç´ æ•°é‡ã€‚

{{index "findIndex method", "indexOf method"}}

å®ƒè°ƒç”¨å¦ä¸€ä¸ªæ•°ç»„æ–¹æ³•ï¼š`findIndex`ã€‚è¯¥æ–¹æ³•ç±»ä¼¼ `indexOf`ï¼Œä½†ä¸å…¶æ‰¾ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œå®ƒæ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆç»™å®šå‡½æ•°è¦æ±‚çš„å€¼ã€‚å’Œ `indexOf` ä¸€æ ·ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸å­˜åœ¨ï¼Œå®ƒä¼šè¿”å› -1ã€‚

{{index "textScripts function", "Chinese characters"}}

é€šè¿‡ `countBy`ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‘Šè¯‰æˆ‘ä»¬å“ªä¸ªæ–‡å­—å‡ºç°åœ¨ä¸€ç¯‡æ–‡ç« ä¸­çš„å‡½æ•°ã€‚

```{includeCode: strip_log, startCode: true}
function textScripts(text) {
  let scripts = countBy(text, char => {
    let script = characterScript(char.codePointAt(0));
    return script ? script.name : "none";
  }).filter(({name}) => name != "none");

  let total = scripts.reduce((n, {count}) => n + count, 0);
  if (total == 0) return "No scripts found";

  return scripts.map(({name, count}) => {
    return `${Math.round(count * 100 / total)}% ${name}`;
  }).join(", ");
}

console.log(textScripts('è‹±å›½çš„ç‹—è¯´"woof", ä¿„ç½—æ–¯çš„ç‹—è¯´"Ñ‚ÑĞ²"'));
// â†’ 61% Han, 22% Latin, 17% Cyrillic
```

{{index "characterScript function", "filter method"}}

è¯¥å‡½æ•°é¦–å…ˆç”¨ `characterScript` ç»™æ¯ä¸ªå­—ç¬¦ä¸€ä¸ªåå­—æˆ–è€… `"none"` å¦‚æœå®ƒä¸å±äºä»»ä½•æ–‡å­—ï¼Œåœ¨æ ¹æ®å…¶åå­—è¿›è¡Œç»Ÿè®¡ã€‚é€šè¿‡ `filter` æ’é™¤æ‰€ä»¥åä¸º `"none"` çš„æ–‡å­—ï¼Œå› ä¸ºæˆ‘ä»¬å¯¹è¿™äº›å­—ç¬¦æ²¡å…´è¶£ã€‚

{{index "reduce method", "map method", "join method", [array, methods]}}

ä¸ºäº†è®¡ç®—((ç™¾åˆ†æ¯”))ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡ `reduce` è®¡ç®—å‡ºä¸€ä¸ªæ–‡å­—ä¸­æ‰€æœ‰å­—ç¬¦çš„æ•°é‡ã€‚å¦‚æœè¿™ä¸ªå­—ç¬¦ä¸å­˜åœ¨ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ã€‚å¦åˆ™ï¼Œå®ƒé€šè¿‡ `map` å°†ç»Ÿè®¡çš„ç»“æœå˜æˆå¯è¯»çš„å­—ç¬¦ä¸²ï¼Œåœ¨é€šè¿‡ `join` å°†ä»–ä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚

## Summary

å°†å‡½æ•°å€¼ä¼ é€’ç»™å…¶ä»–å‡½æ•°æ˜¯ JavaScript ä¸­éå¸¸é‡è¦çš„å­˜åœ¨ã€‚å®ƒå…è®¸æˆ‘ä»¬ç¼–å†™å¸¦æœ‰â€œç©ºéš™â€çš„è®¡ç®—æ¨¡å‹ã€‚è€Œè¿™äº›ç©ºéš™åˆ™ç”±è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç æä¾›ã€‚

æ•°ç»„æä¾›è®¸å¤šé«˜é˜¶æ–¹æ³•ã€‚ä½ å¯ä»¥ç”¨ `forEach` éå†ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ã€‚`filter` æ–¹æ³•è¿”å›ä¸€ä¸ªåªåŒ…æ‹¬ç¬¦åˆ((åˆ¤æ–­å‡½æ•°))çš„æ–°æ•°ç»„ã€‚ä½ å¯ä»¥é€šè¿‡ `map` æ”¹å˜ä¸€ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ä¹Ÿå¯ä»¥ç”¨ `reduce` å°†æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ ç»“åˆæˆä¸€ä¸ªå€¼ã€‚è€Œ `some` åˆ™æµ‹è¯•è¯¥æ•°ç»„ä¸­æœ‰æ²¡æœ‰ç¬¦åˆåˆ¤æ–­å‡½æ•°æ¡ä»¶çš„å…ƒç´ ã€‚æœ€åï¼Œ`findIndex` ä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆåˆ¤æ–­æ¡ä»¶çš„å…ƒç´ çš„ç´¢å¼•ã€‚

## Exercises

### Flattening

{{index "flattening (exercise)", "reduce method", "concat method", [array, flattening]}}

ç»“åˆ `reduce` å’Œ `concat` å°†ä¸€ä¸ªåµŒå¥—æ•°ç»„â€œå±•å¹³â€æˆä¸€ä¸ªå«æœ‰æ‰€æœ‰å…ƒç´ çš„å•ä¸ªæ•°ç»„ã€‚

{{if interactive

```{test: no}
let arrays = [[1, 2, 3], [4, 5], [6]];
// ä½ çš„ä»£ç 
// â†’ [1, 2, 3, 4, 5, 6]
```
if}}

### Your own loop

{{index "your own loop (example)", "for loop"}}

å†™ä¸€ä¸ªç±»ä¼¼ `for` çš„é«˜é˜¶å‡½æ•° `loop`ã€‚å®ƒçš„å‚æ•°åŒ…æ‹¬ä¸€ä¸ªå€¼ï¼Œä¸€ä¸ªåˆ¤æ–­å‡½æ•°ï¼Œä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œå’Œä¸€ä¸ªå—å‡½æ•°ã€‚æ¯æ¬¡è¿­ä»£ï¼Œå®ƒé¦–å…ˆå¯¹ç°æœ‰å€¼è¿è¡Œåˆ¤æ–­å‡½æ•°ï¼Œå¹¶åœæ­¢å¦‚æœå…¶ç»“æœæ˜¯ falseã€‚ä¹‹åï¼Œå®ƒä¼šè°ƒç”¨å—å‡½æ•°ï¼Œæä¾›ç°æœ‰å€¼ã€‚æœ€åå®ƒè°ƒç”¨æ›´æ–°å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ–°çš„å€¼ï¼Œå¹¶é‡æ–°æ¥è¿‡ã€‚

åœ¨å®šä¹‰è¯¥å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥åˆ©ç”¨ä¸€ä¸ªæ­£å¸¸çš„å¾ªç¯æ¥è¿›è¡Œéå†ã€‚

{{if interactive

```{test: no}
// ä½ çš„ä»£ç 

loop(3, n => n > 0, n => n - 1, console.log);
// â†’ 3
// â†’ 2
// â†’ 1
```

if}}

### Everything

{{index "predicate function", "everything (exercise)", "every method", "some method", [array, methods], "&& operator", "|| operator"}}

ç±»ä¼¼ `some` æ–¹æ³•ï¼Œæ•°ç»„ä¹Ÿæœ‰ä¸€ä¸ª `every` æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å› trueã€‚è¯¥å‡½æ•°åªæœ‰åœ¨æ•°ç»„ä¸­_æ‰€æœ‰_å…ƒç´ éƒ½ç¬¦åˆåˆ¤æ–­æ˜¯æ‰ä¼šè¿”å› trueã€‚æ¢å¥è¯è¯´ï¼Œ`some` ç±»ä¼¼äºæ•°ç»„ä¸­çš„ `||`ï¼Œè€Œ `every` åˆ™æ˜¯ `&&`ã€‚

è®¾è®¡ä¸€ä¸ª `every` å‡½æ•°ï¼Œå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªåˆ¤æ–­å‡½æ•°ã€‚å†™ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç¬¬ä¸€ä¸ªç”¨å¾ªç¯ï¼Œç¬¬äºŒä¸ªç”¨ `some` æ–¹æ³•ã€‚

{{if interactive

```{test: no}
function every(array, test) {
  // ä½ çš„ä»£ç 
}

console.log(every([1, 3, 5], n => n < 10));
// â†’ true
console.log(every([2, 4, 16], n => n < 10));
// â†’ false
console.log(every([], n => n < 10));
// â†’ true
```

if}}

{{hint

{{index "everything (exercise)", "short-circuit evaluation", "return keyword"}}

ç±»ä¼¼ `&&`ï¼Œ`every` å¯ä»¥åœ¨é‡åˆ°ç¬¬ä¸€ä¸ªä¸ç¬¦åˆè¦æ±‚çš„å…ƒç´ æ—¶å°±åœæ­¢è¿è¡Œã€‚æ‰€ä»¥å¾ªç¯çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨å‘ç°ä¸ç¬¦åˆåˆ¤æ–­æ¡ä»¶çš„å…ƒç´ çš„ç¬¬ä¸€æ—¶é—´ç”¨ `break` æˆ–è€… `return` è·³å‡ºå¾ªç¯ã€‚å¦‚æœéå†çš„æ¯ä¸€ä¸ªå…ƒç´ åï¼Œä¾æ—§æ²¡æœ‰æ‰¾åˆ°ä¸ç¬¦åˆè¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿”å› `true`ã€‚

åœ¨ `some` çš„åŸºç¡€ä¸Šç¼–å†™ `every`ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨_((å¾·æ‘©æ ¹å®šå¾‹))_ï¼š`a && b` ç­‰äº `!(!a || !b)`ã€‚è¿™ä¸ªå¯ä»¥æ¨å¹¿åˆ°æ•°ç»„ï¼šæ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ éƒ½ç¬¦åˆè¦æ±‚ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ ä¸ç¬¦åˆè¦æ±‚ã€‚

hint}}

### Dominant writing direction

{{index "SCRIPTS data set", "direction (writing)", "groupBy function", "dominant direction (exercise)"}}

å†™ä¸€ä¸ªç¨‹åºè®¡ç®—ä¸€ç¯‡æ–‡å­—ä¸­çš„ä¸»è¦ä¹¦å†™æ–¹å‘ã€‚æ¯ä¸ªæ–‡å­—å¯¹è±¡æœ‰ä¸€ä¸ª `direction` å±æ€§ï¼Œå®ƒçš„å€¼åªèƒ½æ˜¯ `"ltr"`ï¼ˆä»å·¦åˆ°å³ï¼‰ã€`"rtl"`ï¼ˆä»å³åˆ°å·¦ï¼‰ã€å’Œ `"ttb"`ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰ã€‚

{{index "characterScript function", "countBy function"}}

ä¸»è¦ä¹¦å†™æ–¹å‘æ˜¯æœ‰æ–‡ç« ä¸­å¤§éƒ¨åˆ†å­—ç¬¦çš„æ–¹å‘æ‰€å†³å®šçš„ã€‚å‰é¢æåˆ°çš„ `characterScript` å’Œ `countBy` å¯ä»¥å¸®åŠ©ä½ ã€‚

{{if interactive

```{test: no}
function dominantDirection(text) {
  // ä½ çš„ä»£ç 
}

console.log(dominantDirection("Hello!"));
// â†’ ltr
console.log(dominantDirection("Hey, Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±"));
// â†’ rtl
```
if}}

{{hint

{{index "dominant direction (exercise)", "textScripts function", "filter method", "characterScript function"}}

ä½ çš„ç­”æ¡ˆåº”è¯¥å’Œ `textScript` çš„å‰åŠéƒ¨ç›¸ä¼¼ã€‚ä½ ä¾æ—§éœ€è¦åˆ©ç”¨ `characterScript` ç»Ÿè®¡æ–‡ç« ä¸­å‡ºç°çš„å­—ç¬¦ï¼Œåœ¨è¿‡æ»¤æ‰æ²¡æœ‰å…´è¶£çš„ï¼ˆä¸ç¬¦åˆä»»ä½•æ–‡å­—çš„ï¼‰å­—ç¬¦ã€‚

{{index "reduce method"}}

å¯ä»¥é€šè¿‡ `reduce` æ‰¾å¯»æœ€å¤šå­—ç¬¦çš„ä¹¦å†™æ–¹æ³•ã€‚å¯ä»¥å‚è€ƒæœ¬ç« çš„ä¾‹é¢˜ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•åˆ©ç”¨ `reduce` æ‰¾å¯»æœ€å¤šå­—ç¬¦çš„æ–‡å­—çš„ã€‚

hint}}
